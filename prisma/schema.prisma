// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  //output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  TEACHER
  ADMIN
}

model User {
  id    Int             @id @default(autoincrement())
  email String          @unique
  name  String?         @unique
  role  Role

  //Relasjoner:
  createdAgents         Agents[]                      @relation("Creator")
  assignedStudents      StudentAgentAssignment[]      @relation("Student")
  assignedByTeacher     StudentAgentAssignment[]      @relation("Assigned_by")
}

model Agents {
  id Int                @id @default(autoincrement())
  agent_id String       @unique
  created_by Int 
  is_public Boolean     @default(false)
  name      String    

  //Definerer foreign key:
  creator               User                          @relation("Creator", fields: [created_by], references: [id]) 
  studentAssignments    StudentAgentAssignment[]      @relation("Agent")
}

model StudentAgentAssignment {
  id Int                @id @default(autoincrement())
  agent_id Int
  student_id Int
  assigned_by Int 

  //Relasjoner:
  agent                 Agents                        @relation("Agent", fields: [agent_id], references: [id])
  student               User                          @relation("Student", fields: [student_id], references: [id])
  teacher               User                          @relation("Assigned_by", fields: [assigned_by], references: [id])

  @@unique([agent_id, student_id])

}

//Dersom lærere også skal ha restriksjoner på hvilke agenter de har tilgang til. Opprett en TeacherAgentAssignment
//Lik som StudentAgentAssignment